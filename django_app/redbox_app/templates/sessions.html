{% set pageTitle = "Chat" %}
{% extends "base.html" %}
{% from "macros/govuk-button.html" import govukButton %}

{% block content %}

{% compress js %}
  <script src="{{ static('js/alpine.min.js') }}"></script>
{% endcompress %}

<div class="govuk-grid-row govuk-!-margin-top-3">

  <div class="govuk-grid-column-one-third">

      {{ govukButton(
        text="Start a new session",
        href="/sessions",
        classes="govuk-button--secondary"
      ) }}

      <h2 class="govuk-heading-s">Recent sessions</h2>
      <ul class="govuk-list govuk-list--spaced">
        {% for session in chat_history %}
          <li>
            <a class="govuk-link" href="/sessions/{{ session.id }}">{{ session.name }}</a>
          </li>
        {% endfor %}
      </ul>
      
  </div>

  <div class="govuk-grid-column-two-thirds">

      <h2 class="govuk-heading-m">Current session</h2>

      <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
        <div class="govuk-notification-banner__header">
          <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
            Important
          </h2>
        </div>
        <div class="govuk-notification-banner__content">
          <p class="govuk-!-margin-bottom-1 govuk-!-margin-top-0">Responses are generated by Artificial Intelligence (AI)</p>
          <p class="govuk-notification-banner__heading">
            You must check the response for accuracy
          </p>
        </div>
      </div>

      {% for message in messages %}
        <div class="iai-chat-message iai-chat-message--{{ message.role }} govuk-body">
          <div class="iai-chat-message__role">{{ message.role | upper }}</div>
          <div class="iai-chat-message__text">{{ message.text }}</div>
        </div>
      {% endfor %}

      <form class="iai-new-message js-send-message" action="/post-message/" method="post">

        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}"/>
        <input type="hidden" name="session-id" value="{{ session_id }}"/>

        <div class="govuk-form-group">
          <label class="govuk-label" for="message">
            Write a message
          </label>
          <textarea class="govuk-textarea" id="message" name="message" rows="5" required></textarea>
        </div>

        {{ govukButton(
          text="Send"
        ) }}

      </form>

  </div>

</div>

{% endblock %}